#include "gpio_setup.h"
#include "AS5600.h"

#define PIN_MODE_INPUT 0x00U
#define PIN_MODE_OUTPUT 0x01U
#define PIN_MODE_ALTERNATE 0x02U
#define CLEAR_BITS 0x03U

#define LED_BUILTIN_PIN_Pos 3U
#define LED_BUILTIN_PORT GPIOB

void GPIO_Init(void)
{
    RCC->AHB2ENR |= RCC_AHB2ENR_GPIOBEN;
    RCC->AHB2ENR |= RCC_AHB2ENR_GPIOAEN;

    AS5600_DIR_PORT->MODER |= (PIN_MODE_OUTPUT << AS5600_DIR_PIN_Pos * 2U);
    AS5600_DIR_PORT->OSPEEDR |= (0x01U << AS5600_DIR_PIN_Pos * 2U);
    AS5600_DIR_PORT->PUPDR |= (0x01U << AS5600_DIR_PIN_Pos * 2U);

    AS5600_I2C_SCL_PORT->MODER |= (PIN_MODE_ALTERNATE << AS5600_I2C_SCL_PIN_Pos * 2U);
    AS5600_I2C_SDA_PORT->MODER |= (PIN_MODE_ALTERNATE << AS5600_I2C_SDA_PIN_Pos * 2U);
    AS5600_I2C_SCL_PORT->OSPEEDR |= (0x03U << AS5600_I2C_SCL_PIN_Pos * 2U);
    AS5600_I2C_SDA_PORT->OSPEEDR |= (0x03U << AS5600_I2C_SDA_PIN_Pos * 2U);
    AS5600_I2C_SCL_PORT->OTYPER |= (0x01U << AS5600_I2C_SCL_PIN_Pos);
    AS5600_I2C_SDA_PORT->OTYPER |= (0x01U << AS5600_I2C_SDA_PIN_Pos);
    AS5600_I2C_SCL_PORT->PUPDR |= (0x01U << AS5600_I2C_SCL_PIN_Pos * 2U);
    AS5600_I2C_SDA_PORT->PUPDR |= (0x01U << AS5600_I2C_SDA_PIN_Pos * 2U);

    
    LED_BUILTIN_PORT->MODER |= (PIN_MODE_OUTPUT << LED_BUILTIN_PIN_Pos * 2U);
    LED_BUILTIN_PORT->OSPEEDR |= (0x01U << LED_BUILTIN_PIN_Pos * 2U);
}
